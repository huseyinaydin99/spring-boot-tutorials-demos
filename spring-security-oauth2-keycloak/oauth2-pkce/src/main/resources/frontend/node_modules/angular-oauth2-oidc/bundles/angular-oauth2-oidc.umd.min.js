!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("angular-oauth2-oidc",["exports","@angular/core","@angular/common","@angular/common/http","rxjs","rxjs/operators"],t):t((e=e||self)["angular-oauth2-oidc"]={},e.ng.core,e.ng.common,e.ng.common.http,e.rxjs,e.rxjs.operators)}(this,(function(exports,core,common,http,rxjs,operators){"use strict";var LoginOptions=function(){this.preventClearHashAfterLogin=!1},OAuthLogger=function(){},OAuthStorage=function(){},MemoryStorage=function(){function e(){this.data=new Map}return e.prototype.getItem=function(e){return this.data.get(e)},e.prototype.removeItem=function(e){this.data.delete(e)},e.prototype.setItem=function(e,t){this.data.set(e,t)},e}();MemoryStorage.decorators=[{type:core.Injectable}];var ReceivedTokens=function(){},extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function __extends(e,t){function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(r[o[n]]=e[o[n]])}return r}function __decorate(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}function __param(e,t){return function(r,o){t(r,o,e)}}function __metadata(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function __awaiter(e,t,r,o){return new(r||(r=Promise))((function(n,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))}function __generator(e,t){var r,o,n,s,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var __createBinding=Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]};function __exportStar(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||__createBinding(t,e,r)}function __values(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],o=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var o,n,s=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(o=s.next()).done;)i.push(o.value)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}function __spreadArrays(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),n=0;for(t=0;t<r;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,n++)o[n]=s[i];return o}function __await(e){return this instanceof __await?(this.v=e,this):new __await(e)}function __asyncGenerator(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,n=r.apply(e,t||[]),s=[];return o={},i("next"),i("throw"),i("return"),o[Symbol.asyncIterator]=function(){return this},o;function i(e){n[e]&&(o[e]=function(t){return new Promise((function(r,o){s.push([e,t,r,o])>1||a(e,t)}))})}function a(e,t){try{(r=n[e](t)).value instanceof __await?Promise.resolve(r.value.v).then(c,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}var r}function c(e){a("next",e)}function u(e){a("throw",e)}function h(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}}function __asyncDelegator(e){var t,r;return t={},o("next"),o("throw",(function(e){throw e})),o("return"),t[Symbol.iterator]=function(){return this},t;function o(o,n){t[o]=e[o]?function(t){return(r=!r)?{value:__await(e[o](t)),done:"return"===o}:n?n(t):t}:n}}function __asyncValues(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(r){t[r]=e[r]&&function(t){return new Promise((function(o,n){(function(e,t,r,o){Promise.resolve(o).then((function(t){e({value:t,done:r})}),t)})(o,n,(t=e[r](t)).done,t.value)}))}}}function __makeTemplateObject(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var __setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function __importStar(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t}function __importDefault(e){return e&&e.__esModule?e:{default:e}}function __classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function __classPrivateFieldSet(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}function b64DecodeUnicode(e){var t=e.replace(/\-/g,"+").replace(/\_/g,"/");return decodeURIComponent(atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function base64UrlEncode(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var ValidationHandler=function(){},AbstractValidationHandler=function(){function e(){}return e.prototype.validateAtHash=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,o,n,s;return __generator(this,(function(i){switch(i.label){case 0:return t=this.inferHashAlgorithm(e.idTokenHeader),[4,this.calcHash(e.accessToken,t)];case 1:return r=i.sent(),o=r.substr(0,r.length/2),n=base64UrlEncode(o),s=e.idTokenClaims.at_hash.replace(/=/g,""),n!==s&&(console.error("exptected at_hash: "+n),console.error("actual at_hash: "+s)),[2,n===s]}}))}))},e.prototype.inferHashAlgorithm=function(e){var t=e.alg;if(!t.match(/^.S[0-9]{3}$/))throw new Error("Algorithm not supported: "+t);return"sha-"+t.substr(2)},e}(),UrlHelperService=function(){function e(){}return e.prototype.getHashFragmentParams=function(e){var t=e||window.location.hash;if(0!==(t=decodeURIComponent(t)).indexOf("#"))return{};var r=t.indexOf("?");return t=r>-1?t.substr(r+1):t.substr(1),this.parseQueryString(t)},e.prototype.parseQueryString=function(e){var t,r,o,n,s,i,a,c={};if(null===e)return c;t=e.split("&");for(var u=0;u<t.length;u++)-1===(o=(r=t[u]).indexOf("="))?(n=r,s=null):(n=r.substr(0,o),s=r.substr(o+1)),i=decodeURIComponent(n),a=decodeURIComponent(s),"/"===i.substr(0,1)&&(i=i.substr(1)),c[i]=a;return c},e}();UrlHelperService.decorators=[{type:core.Injectable}];var OAuthEvent=function(e){this.type=e},OAuthSuccessEvent=function(e){function t(t,r){void 0===r&&(r=null);var o=e.call(this,t)||this;return o.info=r,o}return __extends(t,e),t}(OAuthEvent),OAuthInfoEvent=function(e){function t(t,r){void 0===r&&(r=null);var o=e.call(this,t)||this;return o.info=r,o}return __extends(t,e),t}(OAuthEvent),OAuthErrorEvent=function(e){function t(t,r,o){void 0===o&&(o=null);var n=e.call(this,t)||this;return n.reason=r,n.params=o,n}return __extends(t,e),t}(OAuthEvent),AuthConfig=function(e){this.clientId="",this.redirectUri="",this.postLogoutRedirectUri="",this.loginUrl="",this.scope="openid profile",this.resource="",this.rngUrl="",this.oidc=!0,this.requestAccessToken=!0,this.options=null,this.issuer="",this.logoutUrl="",this.clearHashAfterLogin=!0,this.tokenEndpoint=null,this.revocationEndpoint=null,this.customTokenParameters=[],this.userinfoEndpoint=null,this.responseType="",this.showDebugInformation=!1,this.silentRefreshRedirectUri="",this.silentRefreshMessagePrefix="",this.silentRefreshShowIFrame=!1,this.siletRefreshTimeout=2e4,this.silentRefreshTimeout=2e4,this.dummyClientSecret=null,this.requireHttps="remoteOnly",this.strictDiscoveryDocumentValidation=!0,this.jwks=null,this.customQueryParams=null,this.silentRefreshIFrameName="angular-oauth-oidc-silent-refresh-iframe",this.timeoutFactor=.75,this.sessionChecksEnabled=!1,this.sessionCheckIntervall=3e3,this.sessionCheckIFrameUrl=null,this.sessionCheckIFrameName="angular-oauth-oidc-check-session-iframe",this.disableAtHashCheck=!1,this.skipSubjectCheck=!1,this.useIdTokenHintForSilentRefresh=!1,this.skipIssuerCheck=!1,this.nonceStateSeparator=";",this.useHttpBasicAuth=!1,this.waitForTokenInMsec=0,this.disablePKCE=!1,this.openUri=function(e){location.href=e},e&&Object.assign(this,e)},WebHttpUrlEncodingCodec=function(){function e(){}return e.prototype.encodeKey=function(e){return encodeURIComponent(e)},e.prototype.encodeValue=function(e){return encodeURIComponent(e)},e.prototype.decodeKey=function(e){return decodeURIComponent(e)},e.prototype.decodeValue=function(e){return decodeURIComponent(e)},e}(),ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(r){return new Sha256(t,!0).update(r)[e]()}},ɵ0=createOutputMethod,createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<OUTPUT_TYPES.length;++r){var o=OUTPUT_TYPES[r];t[o]=createOutputMethod(o,e)}return t},ɵ1=createMethod,nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},ɵ2=nodeWrap,createHmacOutputMethod=function(e,t){return function(r,o){return new HmacSha256(r,t,!0).update(o)[e]()}},ɵ3=createHmacOutputMethod,createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<OUTPUT_TYPES.length;++r){var o=OUTPUT_TYPES[r];t[o]=createHmacOutputMethod(o,e)}return t},ɵ4=createHmacMethod;function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,r){var o,n=typeof e;if("string"===n){var s,i=[],a=e.length,c=0;for(o=0;o<a;++o)(s=e.charCodeAt(o))<128?i[c++]=s:s<2048?(i[c++]=192|s>>6,i[c++]=128|63&s):s<55296||s>=57344?(i[c++]=224|s>>12,i[c++]=128|s>>6&63,i[c++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++o)),i[c++]=240|s>>18,i[c++]=128|s>>12&63,i[c++]=128|s>>6&63,i[c++]=128|63&s);e=i}else{if("object"!==n)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var u=[],h=[];for(o=0;o<64;++o){var l=e[o]||0;u[o]=92^l,h[o]=54^l}Sha256.call(this,t,r),this.update(h),this.oKeyPad=u,this.inner=!0,this.sharedMemory=r}Sha256.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"!==r)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var o,n,s=0,i=e.length,a=this.blocks;s<i;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t)for(n=this.start;s<i&&n<64;++s)a[n>>2]|=e[s]<<SHIFT[3&n++];else for(n=this.start;s<i&&n<64;++s)(o=e.charCodeAt(s))<128?a[n>>2]|=o<<SHIFT[3&n++]:o<2048?(a[n>>2]|=(192|o>>6)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]):o<55296||o>=57344?(a[n>>2]|=(224|o>>12)<<SHIFT[3&n++],a[n>>2]|=(128|o>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++s)),a[n>>2]|=(240|o>>18)<<SHIFT[3&n++],a[n>>2]|=(128|o>>12&63)<<SHIFT[3&n++],a[n>>2]|=(128|o>>6&63)<<SHIFT[3&n++],a[n>>2]|=(128|63&o)<<SHIFT[3&n++]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=a[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,r,o,n,s,i,a,c,u=this.h0,h=this.h1,l=this.h2,d=this.h3,p=this.h4,f=this.h5,v=this.h6,g=this.h7,m=this.blocks;for(e=16;e<64;++e)t=((n=m[e-15])>>>7|n<<25)^(n>>>18|n<<14)^n>>>3,r=((n=m[e-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,m[e]=m[e-16]+t+m[e-7]+r<<0;for(c=h&l,e=0;e<64;e+=4)this.first?(this.is224?(s=300032,g=(n=m[0]-1413257819)-150054599<<0,d=n+24177077<<0):(s=704751109,g=(n=m[0]-210244248)-1521486534<<0,d=n+143694565<<0),this.first=!1):(t=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),o=(s=u&h)^u&l^c,g=d+(n=g+(r=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&f^~p&v)+K[e]+m[e])<<0,d=n+(t+o)<<0),t=(d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),o=(i=d&u)^d&h^s,v=l+(n=v+(r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&p^~g&f)+K[e+1]+m[e+1])<<0,t=((l=n+(t+o)<<0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),o=(a=l&d)^l&u^i,f=h+(n=f+(r=(v>>>6|v<<26)^(v>>>11|v<<21)^(v>>>25|v<<7))+(v&g^~v&p)+K[e+2]+m[e+2])<<0,t=((h=n+(t+o)<<0)>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),o=(c=h&l)^h&d^a,p=u+(n=p+(r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&v^~f&g)+K[e+3]+m[e+3])<<0,u=n+(t+o)<<0;this.h0=this.h0+u<<0,this.h1=this.h1+h<<0,this.h2=this.h2+l<<0,this.h3=this.h3+d<<0,this.h4=this.h4+p<<0,this.h5=this.h5+f<<0,this.h6=this.h6+v<<0,this.h7=this.h7+g<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3,n=this.h4,s=this.h5,i=this.h6,a=this.h7,c=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i];return this.is224||(c+=HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]),c},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,o=this.h3,n=this.h4,s=this.h5,i=this.h6,a=this.h7,c=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,o>>24&255,o>>16&255,o>>8&255,255&o,n>>24&255,n>>16&255,n>>8&255,255&n,s>>24&255,s>>16&255,s>>8&255,255&s,i>>24&255,i>>16&255,i>>8&255,255&i];return this.is224||c.push(a>>24&255,a>>16&255,a>>8&255,255&a),c},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports$1=createMethod();exports$1.sha256=exports$1,exports$1.sha224=createMethod(!0),exports$1.sha256.hmac=createHmacMethod(),exports$1.sha224.hmac=createHmacMethod(!0);var HashHandler=function(){},DefaultHashHandler=function(){function e(){}return e.prototype.calcHash=function(e,t){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(r){return t=exports$1.array(e),[2,this.toHashString2(t)]}))}))},e.prototype.toHashString2=function(e){var t,r,o="";try{for(var n=__values(e),s=n.next();!s.done;s=n.next()){var i=s.value;o+=String.fromCharCode(i)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return o},e.prototype.toHashString=function(e){var t,r,o=new Uint8Array(e),n="";try{for(var s=__values(o),i=s.next();!i.done;i=s.next()){var a=i.value;n+=String.fromCharCode(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return n},e}();DefaultHashHandler.decorators=[{type:core.Injectable}];var OAuthService=function(e){function t(t,r,o,n,s,i,a,c,u){var h,l=this;(l=e.call(this)||this).ngZone=t,l.http=r,l.config=s,l.urlHelper=i,l.logger=a,l.crypto=c,l.discoveryDocumentLoaded=!1,l.state="",l.eventsSubject=new rxjs.Subject,l.discoveryDocumentLoadedSubject=new rxjs.Subject,l.grantTypesSupported=[],l.inImplicitFlow=!1,l.saveNoncesInLocalStorage=!1,l.debug("angular-oauth2-oidc v10"),l.document=u,s||(s={}),l.discoveryDocumentLoaded$=l.discoveryDocumentLoadedSubject.asObservable(),l.events=l.eventsSubject.asObservable(),n&&(l.tokenValidationHandler=n),s&&l.configure(s);try{o?l.setStorage(o):"undefined"!=typeof sessionStorage&&l.setStorage(sessionStorage)}catch(e){console.error("No OAuthStorage provided and cannot access default (sessionStorage).Consider providing a custom OAuthStorage implementation in your module.",e)}if("undefined"!=typeof window&&void 0!==window.localStorage){var d=null===(h=null===window||void 0===window?void 0:window.navigator)||void 0===h?void 0:h.userAgent;((null==d?void 0:d.includes("MSIE "))||(null==d?void 0:d.includes("Trident")))&&(l.saveNoncesInLocalStorage=!0)}return l.setupRefreshTimer(),l}return __extends(t,e),t.prototype.configure=function(e){Object.assign(this,new AuthConfig,e),this.config=Object.assign({},new AuthConfig,e),this.sessionChecksEnabled&&this.setupSessionCheck(),this.configChanged()},t.prototype.configChanged=function(){this.setupRefreshTimer()},t.prototype.restartSessionChecksIfStillLoggedIn=function(){this.hasValidIdToken()&&this.initSessionCheck()},t.prototype.restartRefreshTimerIfStillLoggedIn=function(){this.setupExpirationTimers()},t.prototype.setupSessionCheck=function(){var e=this;this.events.pipe(operators.filter((function(e){return"token_received"===e.type}))).subscribe((function(t){e.initSessionCheck()}))},t.prototype.setupAutomaticSilentRefresh=function(e,t,r){var o=this;void 0===e&&(e={}),void 0===r&&(r=!0);var n=!0;this.events.pipe(operators.tap((function(e){"token_received"===e.type?n=!0:"logout"===e.type&&(n=!1)})),operators.filter((function(e){return"token_expires"===e.type})),operators.debounceTime(1e3)).subscribe((function(s){null!=t&&"any"!==t&&s.info!==t||!n||o.refreshInternal(e,r).catch((function(e){o.debug("Automatic silent refresh did not work")}))})),this.restartRefreshTimerIfStillLoggedIn()},t.prototype.refreshInternal=function(e,t){return this.useSilentRefresh||"code"!==this.responseType?this.silentRefresh(e,t):this.refreshToken()},t.prototype.loadDiscoveryDocumentAndTryLogin=function(e){var t=this;return void 0===e&&(e=null),this.loadDiscoveryDocument().then((function(r){return t.tryLogin(e)}))},t.prototype.loadDiscoveryDocumentAndLogin=function(e){var t=this;return void 0===e&&(e=null),e=e||{},this.loadDiscoveryDocumentAndTryLogin(e).then((function(r){if(t.hasValidIdToken()&&t.hasValidAccessToken())return!0;var o="string"==typeof e.state?e.state:"";return t.initLoginFlow(o),!1}))},t.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.showDebugInformation&&this.logger.debug.apply(this.logger,e)},t.prototype.validateUrlFromDiscoveryDocument=function(e){var t=[],r=this.validateUrlForHttps(e),o=this.validateUrlAgainstIssuer(e);return r||t.push("https for all urls required. Also for urls received by discovery."),o||t.push("Every url in discovery document has to start with the issuer url.Also see property strictDiscoveryDocumentValidation."),t},t.prototype.validateUrlForHttps=function(e){if(!e)return!0;var t=e.toLowerCase();return!1===this.requireHttps||(!(!t.match(/^http:\/\/localhost($|[:\/])/)&&!t.match(/^http:\/\/localhost($|[:\/])/)||"remoteOnly"!==this.requireHttps)||t.startsWith("https://"))},t.prototype.assertUrlNotNullAndCorrectProtocol=function(e,t){if(!e)throw new Error("'"+t+"' should not be null");if(!this.validateUrlForHttps(e))throw new Error("'"+t+"' must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).")},t.prototype.validateUrlAgainstIssuer=function(e){return!this.strictDiscoveryDocumentValidation||(!e||e.toLowerCase().startsWith(this.issuer.toLowerCase()))},t.prototype.setupRefreshTimer=function(){var e=this;"undefined"!=typeof window?((this.hasValidIdToken()||this.hasValidAccessToken())&&(this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.setupExpirationTimers()),this.tokenReceivedSubscription&&this.tokenReceivedSubscription.unsubscribe(),this.tokenReceivedSubscription=this.events.pipe(operators.filter((function(e){return"token_received"===e.type}))).subscribe((function(t){e.clearAccessTokenTimer(),e.clearIdTokenTimer(),e.setupExpirationTimers()}))):this.debug("timer not supported on this plattform")},t.prototype.setupExpirationTimers=function(){this.hasValidAccessToken()&&this.setupAccessTokenTimer(),this.hasValidIdToken()&&this.setupIdTokenTimer()},t.prototype.setupAccessTokenTimer=function(){var e=this,t=this.getAccessTokenExpiration(),r=this.getAccessTokenStoredAt(),o=this.calcTimeout(r,t);this.ngZone.runOutsideAngular((function(){e.accessTokenTimeoutSubscription=rxjs.of(new OAuthInfoEvent("token_expires","access_token")).pipe(operators.delay(o)).subscribe((function(t){e.ngZone.run((function(){e.eventsSubject.next(t)}))}))}))},t.prototype.setupIdTokenTimer=function(){var e=this,t=this.getIdTokenExpiration(),r=this.getIdTokenStoredAt(),o=this.calcTimeout(r,t);this.ngZone.runOutsideAngular((function(){e.idTokenTimeoutSubscription=rxjs.of(new OAuthInfoEvent("token_expires","id_token")).pipe(operators.delay(o)).subscribe((function(t){e.ngZone.run((function(){e.eventsSubject.next(t)}))}))}))},t.prototype.stopAutomaticRefresh=function(){this.clearAccessTokenTimer(),this.clearIdTokenTimer()},t.prototype.clearAccessTokenTimer=function(){this.accessTokenTimeoutSubscription&&this.accessTokenTimeoutSubscription.unsubscribe()},t.prototype.clearIdTokenTimer=function(){this.idTokenTimeoutSubscription&&this.idTokenTimeoutSubscription.unsubscribe()},t.prototype.calcTimeout=function(e,t){var r=Date.now(),o=(t-e)*this.timeoutFactor-(r-e);return Math.max(0,o)},t.prototype.setStorage=function(e){this._storage=e,this.configChanged()},t.prototype.loadDiscoveryDocument=function(e){var t=this;return void 0===e&&(e=null),new Promise((function(r,o){e||((e=t.issuer||"").endsWith("/")||(e+="/"),e+=".well-known/openid-configuration"),t.validateUrlForHttps(e)?t.http.get(e).subscribe((function(e){if(!t.validateDiscoveryDocument(e))return t.eventsSubject.next(new OAuthErrorEvent("discovery_document_validation_error",null)),void o("discovery_document_validation_error");t.loginUrl=e.authorization_endpoint,t.logoutUrl=e.end_session_endpoint||t.logoutUrl,t.grantTypesSupported=e.grant_types_supported,t.issuer=e.issuer,t.tokenEndpoint=e.token_endpoint,t.userinfoEndpoint=e.userinfo_endpoint||t.userinfoEndpoint,t.jwksUri=e.jwks_uri,t.sessionCheckIFrameUrl=e.check_session_iframe||t.sessionCheckIFrameUrl,t.discoveryDocumentLoaded=!0,t.discoveryDocumentLoadedSubject.next(e),t.revocationEndpoint=e.revocation_endpoint,t.sessionChecksEnabled&&t.restartSessionChecksIfStillLoggedIn(),t.loadJwks().then((function(o){var n=new OAuthSuccessEvent("discovery_document_loaded",{discoveryDocument:e,jwks:o});t.eventsSubject.next(n),r(n)})).catch((function(e){t.eventsSubject.next(new OAuthErrorEvent("discovery_document_load_error",e)),o(e)}))}),(function(e){t.logger.error("error loading discovery document",e),t.eventsSubject.next(new OAuthErrorEvent("discovery_document_load_error",e)),o(e)})):o("issuer  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).")}))},t.prototype.loadJwks=function(){var e=this;return new Promise((function(t,r){e.jwksUri?e.http.get(e.jwksUri).subscribe((function(r){e.jwks=r,e.eventsSubject.next(new OAuthSuccessEvent("discovery_document_loaded")),t(r)}),(function(t){e.logger.error("error loading jwks",t),e.eventsSubject.next(new OAuthErrorEvent("jwks_load_error",t)),r(t)})):t(null)}))},t.prototype.validateDiscoveryDocument=function(e){var t;return this.skipIssuerCheck||e.issuer===this.issuer?(t=this.validateUrlFromDiscoveryDocument(e.authorization_endpoint)).length>0?(this.logger.error("error validating authorization_endpoint in discovery document",t),!1):(t=this.validateUrlFromDiscoveryDocument(e.end_session_endpoint)).length>0?(this.logger.error("error validating end_session_endpoint in discovery document",t),!1):((t=this.validateUrlFromDiscoveryDocument(e.token_endpoint)).length>0&&this.logger.error("error validating token_endpoint in discovery document",t),(t=this.validateUrlFromDiscoveryDocument(e.revocation_endpoint)).length>0&&this.logger.error("error validating revocation_endpoint in discovery document",t),(t=this.validateUrlFromDiscoveryDocument(e.userinfo_endpoint)).length>0?(this.logger.error("error validating userinfo_endpoint in discovery document",t),!1):(t=this.validateUrlFromDiscoveryDocument(e.jwks_uri)).length>0?(this.logger.error("error validating jwks_uri in discovery document",t),!1):(this.sessionChecksEnabled&&!e.check_session_iframe&&this.logger.warn("sessionChecksEnabled is activated but discovery document does not contain a check_session_iframe field"),!0)):(this.logger.error("invalid issuer in discovery document","expected: "+this.issuer,"current: "+e.issuer),!1)},t.prototype.fetchTokenUsingPasswordFlowAndLoadUserProfile=function(e,t,r){var o=this;return void 0===r&&(r=new http.HttpHeaders),this.fetchTokenUsingPasswordFlow(e,t,r).then((function(){return o.loadUserProfile()}))},t.prototype.loadUserProfile=function(){var e=this;if(!this.hasValidAccessToken())throw new Error("Can not load User Profile without access_token");if(!this.validateUrlForHttps(this.userinfoEndpoint))throw new Error("userinfoEndpoint must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");return new Promise((function(t,r){var o=(new http.HttpHeaders).set("Authorization","Bearer "+e.getAccessToken());e.http.get(e.userinfoEndpoint,{headers:o}).subscribe((function(o){e.debug("userinfo received",o);var n=e.getIdentityClaims()||{};if(e.skipSubjectCheck||!e.oidc||n.sub&&o.sub===n.sub)o=Object.assign({},n,o),e._storage.setItem("id_token_claims_obj",JSON.stringify(o)),e.eventsSubject.next(new OAuthSuccessEvent("user_profile_loaded")),t(o);else{r("if property oidc is true, the received user-id (sub) has to be the user-id of the user that has logged in with oidc.\nif you are not using oidc but just oauth2 password flow set oidc to false")}}),(function(t){e.logger.error("error loading user info",t),e.eventsSubject.next(new OAuthErrorEvent("user_profile_load_error",t)),r(t)}))}))},t.prototype.fetchTokenUsingPasswordFlow=function(e,t,r){var o=this;return void 0===r&&(r=new http.HttpHeaders),this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint"),new Promise((function(n,s){var i,a,c=new http.HttpParams({encoder:new WebHttpUrlEncodingCodec}).set("grant_type","password").set("scope",o.scope).set("username",e).set("password",t);if(o.useHttpBasicAuth){var u=btoa(o.clientId+":"+o.dummyClientSecret);r=r.set("Authorization","Basic "+u)}if(o.useHttpBasicAuth||(c=c.set("client_id",o.clientId)),!o.useHttpBasicAuth&&o.dummyClientSecret&&(c=c.set("client_secret",o.dummyClientSecret)),o.customQueryParams)try{for(var h=__values(Object.getOwnPropertyNames(o.customQueryParams)),l=h.next();!l.done;l=h.next()){var d=l.value;c=c.set(d,o.customQueryParams[d])}}catch(e){i={error:e}}finally{try{l&&!l.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}r=r.set("Content-Type","application/x-www-form-urlencoded"),o.http.post(o.tokenEndpoint,c,{headers:r}).subscribe((function(e){o.debug("tokenResponse",e),o.storeAccessTokenResponse(e.access_token,e.refresh_token,e.expires_in||o.fallbackAccessTokenExpirationTimeInSec,e.scope,o.extractRecognizedCustomParameters(e)),o.eventsSubject.next(new OAuthSuccessEvent("token_received")),n(e)}),(function(e){o.logger.error("Error performing password flow",e),o.eventsSubject.next(new OAuthErrorEvent("token_error",e)),s(e)}))}))},t.prototype.refreshToken=function(){var e=this;return this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint"),new Promise((function(t,r){var o,n,s=(new http.HttpParams).set("grant_type","refresh_token").set("scope",e.scope).set("refresh_token",e._storage.getItem("refresh_token")),i=(new http.HttpHeaders).set("Content-Type","application/x-www-form-urlencoded");if(e.useHttpBasicAuth){var a=btoa(e.clientId+":"+e.dummyClientSecret);i=i.set("Authorization","Basic "+a)}if(e.useHttpBasicAuth||(s=s.set("client_id",e.clientId)),!e.useHttpBasicAuth&&e.dummyClientSecret&&(s=s.set("client_secret",e.dummyClientSecret)),e.customQueryParams)try{for(var c=__values(Object.getOwnPropertyNames(e.customQueryParams)),u=c.next();!u.done;u=c.next()){var h=u.value;s=s.set(h,e.customQueryParams[h])}}catch(e){o={error:e}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(o)throw o.error}}e.http.post(e.tokenEndpoint,s,{headers:i}).pipe(operators.switchMap((function(t){return t.id_token?rxjs.from(e.processIdToken(t.id_token,t.access_token,!0)).pipe(operators.tap((function(t){return e.storeIdToken(t)})),operators.map((function(e){return t}))):rxjs.of(t)}))).subscribe((function(r){e.debug("refresh tokenResponse",r),e.storeAccessTokenResponse(r.access_token,r.refresh_token,r.expires_in||e.fallbackAccessTokenExpirationTimeInSec,r.scope,e.extractRecognizedCustomParameters(r)),e.eventsSubject.next(new OAuthSuccessEvent("token_received")),e.eventsSubject.next(new OAuthSuccessEvent("token_refreshed")),t(r)}),(function(t){e.logger.error("Error refreshing token",t),e.eventsSubject.next(new OAuthErrorEvent("token_refresh_error",t)),r(t)}))}))},t.prototype.removeSilentRefreshEventListener=function(){this.silentRefreshPostMessageEventListener&&(window.removeEventListener("message",this.silentRefreshPostMessageEventListener),this.silentRefreshPostMessageEventListener=null)},t.prototype.setupSilentRefreshEventListener=function(){var e=this;this.removeSilentRefreshEventListener(),this.silentRefreshPostMessageEventListener=function(t){var r=e.processMessageEventMessage(t);e.tryLogin({customHashFragment:r,preventClearHashAfterLogin:!0,customRedirectUri:e.silentRefreshRedirectUri||e.redirectUri}).catch((function(t){return e.debug("tryLogin during silent refresh failed",t)}))},window.addEventListener("message",this.silentRefreshPostMessageEventListener)},t.prototype.silentRefresh=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t=!0);var o=this.getIdentityClaims()||{};if(this.useIdTokenHintForSilentRefresh&&this.hasValidIdToken()&&(e.id_token_hint=this.getIdToken()),!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(void 0===this.document)throw new Error("silent refresh is not supported on this platform");var n=this.document.getElementById(this.silentRefreshIFrameName);n&&this.document.body.removeChild(n),this.silentRefreshSubject=o.sub;var s=this.document.createElement("iframe");s.id=this.silentRefreshIFrameName,this.setupSilentRefreshEventListener();var i=this.silentRefreshRedirectUri||this.redirectUri;this.createLoginUrl(null,null,i,t,e).then((function(e){s.setAttribute("src",e),r.silentRefreshShowIFrame||(s.style.display="none"),r.document.body.appendChild(s)}));var a=this.events.pipe(operators.filter((function(e){return e instanceof OAuthErrorEvent})),operators.first()),c=this.events.pipe(operators.filter((function(e){return"token_received"===e.type})),operators.first()),u=rxjs.of(new OAuthErrorEvent("silent_refresh_timeout",null)).pipe(operators.delay(this.silentRefreshTimeout));return rxjs.race([a,c,u]).pipe(operators.map((function(e){if(e instanceof OAuthErrorEvent)throw"silent_refresh_timeout"===e.type||(e=new OAuthErrorEvent("silent_refresh_error",e)),r.eventsSubject.next(e),e;return"token_received"===e.type&&(e=new OAuthSuccessEvent("silently_refreshed"),r.eventsSubject.next(e)),e}))).toPromise()},t.prototype.initImplicitFlowInPopup=function(e){return this.initLoginFlowInPopup(e)},t.prototype.initLoginFlowInPopup=function(e){var t=this;return e=e||{},this.createLoginUrl(null,null,this.silentRefreshRedirectUri,!1,{display:"popup"}).then((function(r){return new Promise((function(o,n){var s,i=window.open(r,"_blank",t.calculatePopupFeatures(e));i?s=window.setInterval((function(){i&&!i.closed||(a(),n(new OAuthErrorEvent("popup_closed",{})))}),500):n(new OAuthErrorEvent("popup_blocked",{}));var a=function(){window.clearInterval(s),window.removeEventListener("message",c),null!==i&&i.close(),i=null},c=function(e){var r=t.processMessageEventMessage(e);r&&null!==r?t.tryLogin({customHashFragment:r,preventClearHashAfterLogin:!0,customRedirectUri:t.silentRefreshRedirectUri}).then((function(){a(),o()}),(function(e){a(),n(e)})):console.log("false event firing")};window.addEventListener("message",c)}))}))},t.prototype.calculatePopupFeatures=function(e){var t=e.height||470,r=e.width||500,o=window.screenLeft+(window.outerWidth-r)/2;return"location=no,toolbar=no,width="+r+",height="+t+",top="+(window.screenTop+(window.outerHeight-t)/2)+",left="+o},t.prototype.processMessageEventMessage=function(e){var t="#";if(this.silentRefreshMessagePrefix&&(t+=this.silentRefreshMessagePrefix),e&&e.data&&"string"==typeof e.data){var r=e.data;if(r.startsWith(t))return"#"+r.substr(t.length)}},t.prototype.canPerformSessionCheck=function(){return!!this.sessionChecksEnabled&&(this.sessionCheckIFrameUrl?this.getSessionState()?void 0!==this.document:(console.warn("sessionChecksEnabled is activated but there is no session_state"),!1):(console.warn("sessionChecksEnabled is activated but there is no sessionCheckIFrameUrl"),!1))},t.prototype.setupSessionCheckEventListener=function(){var e=this;this.removeSessionCheckEventListener(),this.sessionCheckEventListener=function(t){var r=t.origin.toLowerCase(),o=e.issuer.toLowerCase();if(e.debug("sessionCheckEventListener"),o.startsWith(r)){switch(t.data){case"unchanged":e.handleSessionUnchanged();break;case"changed":e.ngZone.run((function(){e.handleSessionChange()}));break;case"error":e.ngZone.run((function(){e.handleSessionError()}))}e.debug("got info from session check inframe",t)}else e.debug("sessionCheckEventListener","wrong origin",r,"expected",o,"event",t)},this.ngZone.runOutsideAngular((function(){window.addEventListener("message",e.sessionCheckEventListener)}))},t.prototype.handleSessionUnchanged=function(){this.debug("session check","session unchanged")},t.prototype.handleSessionChange=function(){var e=this;this.eventsSubject.next(new OAuthInfoEvent("session_changed")),this.stopSessionCheckTimer(),this.useSilentRefresh||"code"!==this.responseType?this.silentRefreshRedirectUri?(this.silentRefresh().catch((function(t){return e.debug("silent refresh failed after session changed")})),this.waitForSilentRefreshAfterSessionChange()):(this.eventsSubject.next(new OAuthInfoEvent("session_terminated")),this.logOut(!0)):this.refreshToken().then((function(t){e.debug("token refresh after session change worked")})).catch((function(t){e.debug("token refresh did not work after session changed"),e.eventsSubject.next(new OAuthInfoEvent("session_terminated")),e.logOut(!0)}))},t.prototype.waitForSilentRefreshAfterSessionChange=function(){var e=this;this.events.pipe(operators.filter((function(e){return"silently_refreshed"===e.type||"silent_refresh_timeout"===e.type||"silent_refresh_error"===e.type})),operators.first()).subscribe((function(t){"silently_refreshed"!==t.type&&(e.debug("silent refresh did not work after session changed"),e.eventsSubject.next(new OAuthInfoEvent("session_terminated")),e.logOut(!0))}))},t.prototype.handleSessionError=function(){this.stopSessionCheckTimer(),this.eventsSubject.next(new OAuthInfoEvent("session_error"))},t.prototype.removeSessionCheckEventListener=function(){this.sessionCheckEventListener&&(window.removeEventListener("message",this.sessionCheckEventListener),this.sessionCheckEventListener=null)},t.prototype.initSessionCheck=function(){if(this.canPerformSessionCheck()){var e=this.document.getElementById(this.sessionCheckIFrameName);e&&this.document.body.removeChild(e);var t=this.document.createElement("iframe");t.id=this.sessionCheckIFrameName,this.setupSessionCheckEventListener();var r=this.sessionCheckIFrameUrl;t.setAttribute("src",r),t.style.display="none",this.document.body.appendChild(t),this.startSessionCheckTimer()}},t.prototype.startSessionCheckTimer=function(){var e=this;this.stopSessionCheckTimer(),this.ngZone.runOutsideAngular((function(){e.sessionCheckTimer=setInterval(e.checkSession.bind(e),e.sessionCheckIntervall)}))},t.prototype.stopSessionCheckTimer=function(){this.sessionCheckTimer&&(clearInterval(this.sessionCheckTimer),this.sessionCheckTimer=null)},t.prototype.checkSession=function(){var e=this.document.getElementById(this.sessionCheckIFrameName);e||this.logger.warn("checkSession did not find iframe",this.sessionCheckIFrameName);var t=this.getSessionState();t||this.stopSessionCheckTimer();var r=this.clientId+" "+t;e.contentWindow.postMessage(r,this.issuer)},t.prototype.createLoginUrl=function(e,t,r,o,n){return void 0===e&&(e=""),void 0===t&&(t=""),void 0===r&&(r=""),void 0===o&&(o=!1),void 0===n&&(n={}),__awaiter(this,void 0,void 0,(function(){var s,i,a,c,u,h,l,d,p,f,v,g,m,y,_,S,k,w;return __generator(this,(function(A){switch(A.label){case 0:return s=this,i=r||this.redirectUri,[4,this.createAndSaveNonce()];case 1:if(a=A.sent(),e=e?a+this.config.nonceStateSeparator+encodeURIComponent(e):a,!this.requestAccessToken&&!this.oidc)throw new Error("Either requestAccessToken or oidc or both must be true");return this.config.responseType?this.responseType=this.config.responseType:this.oidc&&this.requestAccessToken?this.responseType="id_token token":this.oidc&&!this.requestAccessToken?this.responseType="id_token":this.responseType="token",c=s.loginUrl.indexOf("?")>-1?"&":"?",u=s.scope,this.oidc&&!u.match(/(^|\s)openid($|\s)/)&&(u="openid "+u),h=s.loginUrl+c+"response_type="+encodeURIComponent(s.responseType)+"&client_id="+encodeURIComponent(s.clientId)+"&state="+encodeURIComponent(e)+"&redirect_uri="+encodeURIComponent(i)+"&scope="+encodeURIComponent(u),!this.responseType.includes("code")||this.disablePKCE?[3,3]:[4,this.createChallangeVerifierPairForPKCE()];case 2:l=__read.apply(void 0,[A.sent(),2]),d=l[0],p=l[1],this.saveNoncesInLocalStorage&&void 0!==window.localStorage?localStorage.setItem("PKCE_verifier",p):this._storage.setItem("PKCE_verifier",p),h+="&code_challenge="+d,h+="&code_challenge_method=S256",A.label=3;case 3:t&&(h+="&login_hint="+encodeURIComponent(t)),s.resource&&(h+="&resource="+encodeURIComponent(s.resource)),s.oidc&&(h+="&nonce="+encodeURIComponent(a)),o&&(h+="&prompt=none");try{for(f=__values(Object.keys(n)),v=f.next();!v.done;v=f.next())y=v.value,h+="&"+encodeURIComponent(y)+"="+encodeURIComponent(n[y])}catch(e){_={error:e}}finally{try{v&&!v.done&&(S=f.return)&&S.call(f)}finally{if(_)throw _.error}}if(this.customQueryParams)try{for(g=__values(Object.getOwnPropertyNames(this.customQueryParams)),m=g.next();!m.done;m=g.next())y=m.value,h+="&"+y+"="+encodeURIComponent(this.customQueryParams[y])}catch(e){k={error:e}}finally{try{m&&!m.done&&(w=g.return)&&w.call(g)}finally{if(k)throw k.error}}return[2,h]}}))}))},t.prototype.initImplicitFlowInternal=function(e,t){var r=this;if(void 0===e&&(e=""),void 0===t&&(t=""),!this.inImplicitFlow){if(this.inImplicitFlow=!0,!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");var o={},n=null;"string"==typeof t?n=t:"object"==typeof t&&(o=t),this.createLoginUrl(e,n,null,!1,o).then(this.config.openUri).catch((function(e){console.error("Error in initImplicitFlow",e),r.inImplicitFlow=!1}))}},t.prototype.initImplicitFlow=function(e,t){var r=this;void 0===e&&(e=""),void 0===t&&(t=""),""!==this.loginUrl?this.initImplicitFlowInternal(e,t):this.events.pipe(operators.filter((function(e){return"discovery_document_loaded"===e.type}))).subscribe((function(o){return r.initImplicitFlowInternal(e,t)}))},t.prototype.resetImplicitFlow=function(){this.inImplicitFlow=!1},t.prototype.callOnTokenReceivedIfExists=function(e){if(e.onTokenReceived){var t={idClaims:this.getIdentityClaims(),idToken:this.getIdToken(),accessToken:this.getAccessToken(),state:this.state};e.onTokenReceived(t)}},t.prototype.storeAccessTokenResponse=function(e,t,r,o,n){var s=this;if(this._storage.setItem("access_token",e),o&&!Array.isArray(o)?this._storage.setItem("granted_scopes",JSON.stringify(o.split("+"))):o&&Array.isArray(o)&&this._storage.setItem("granted_scopes",JSON.stringify(o)),this._storage.setItem("access_token_stored_at",""+Date.now()),r){var i=1e3*r,a=(new Date).getTime()+i;this._storage.setItem("expires_at",""+a)}t&&this._storage.setItem("refresh_token",t),n&&n.forEach((function(e,t){s._storage.setItem(t,e)}))},t.prototype.tryLogin=function(e){return void 0===e&&(e=null),"code"===this.config.responseType?this.tryLoginCodeFlow(e).then((function(e){return!0})):this.tryLoginImplicitFlow(e)},t.prototype.parseQueryString=function(e){return e&&0!==e.length?("?"===e.charAt(0)&&(e=e.substr(1)),this.urlHelper.parseQueryString(e)):{}},t.prototype.tryLoginCodeFlow=function(e){void 0===e&&(e=null);var t=(e=e||{}).customHashFragment?e.customHashFragment.substring(1):window.location.search,r=this.getCodePartsFromUrl(t),o=r.code,n=r.state,s=r.session_state;if(!e.preventClearHashAfterLogin){var i=location.href.replace(/[&\?]code=[^&\$]*/,"").replace(/[&\?]scope=[^&\$]*/,"").replace(/[&\?]state=[^&\$]*/,"").replace(/[&\?]session_state=[^&\$]*/,"");history.replaceState(null,window.name,i)}var a=__read(this.parseState(n),2),c=a[0],u=a[1];if(this.state=u,r.error){this.debug("error trying to login"),this.handleLoginError({},r);var h=new OAuthErrorEvent("code_error",{},r);return this.eventsSubject.next(h),Promise.reject(h)}if(!c)return Promise.resolve();if(!this.validateNonce(c)){var l=new OAuthErrorEvent("invalid_nonce_in_state",null);return this.eventsSubject.next(l),Promise.reject(l)}return this.storeSessionState(s),o?this.getTokenFromCode(o,e).then((function(e){return null})):Promise.resolve()},t.prototype.getCodePartsFromUrl=function(e){return e&&0!==e.length?("?"===e.charAt(0)&&(e=e.substr(1)),this.urlHelper.parseQueryString(e)):this.urlHelper.getHashFragmentParams()},t.prototype.getTokenFromCode=function(e,t){var r=(new http.HttpParams).set("grant_type","authorization_code").set("code",e).set("redirect_uri",t.customRedirectUri||this.redirectUri);if(!this.disablePKCE){var o=void 0;(o=this.saveNoncesInLocalStorage&&void 0!==window.localStorage?localStorage.getItem("PKCE_verifier"):this._storage.getItem("PKCE_verifier"))?r=r.set("code_verifier",o):console.warn("No PKCE verifier found in oauth storage!")}return this.fetchAndProcessToken(r)},t.prototype.fetchAndProcessToken=function(e){var t=this;this.assertUrlNotNullAndCorrectProtocol(this.tokenEndpoint,"tokenEndpoint");var r=(new http.HttpHeaders).set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){var o=btoa(this.clientId+":"+this.dummyClientSecret);r=r.set("Authorization","Basic "+o)}return this.useHttpBasicAuth||(e=e.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(e=e.set("client_secret",this.dummyClientSecret)),new Promise((function(o,n){var s,i;if(t.customQueryParams)try{for(var a=__values(Object.getOwnPropertyNames(t.customQueryParams)),c=a.next();!c.done;c=a.next()){var u=c.value;e=e.set(u,t.customQueryParams[u])}}catch(e){s={error:e}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}t.http.post(t.tokenEndpoint,e,{headers:r}).subscribe((function(e){t.debug("refresh tokenResponse",e),t.storeAccessTokenResponse(e.access_token,e.refresh_token,e.expires_in||t.fallbackAccessTokenExpirationTimeInSec,e.scope,t.extractRecognizedCustomParameters(e)),t.oidc&&e.id_token?t.processIdToken(e.id_token,e.access_token).then((function(r){t.storeIdToken(r),t.eventsSubject.next(new OAuthSuccessEvent("token_received")),t.eventsSubject.next(new OAuthSuccessEvent("token_refreshed")),o(e)})).catch((function(e){t.eventsSubject.next(new OAuthErrorEvent("token_validation_error",e)),console.error("Error validating tokens"),console.error(e),n(e)})):(t.eventsSubject.next(new OAuthSuccessEvent("token_received")),t.eventsSubject.next(new OAuthSuccessEvent("token_refreshed")),o(e))}),(function(e){console.error("Error getting token",e),t.eventsSubject.next(new OAuthErrorEvent("token_refresh_error",e)),n(e)}))}))},t.prototype.tryLoginImplicitFlow=function(e){var t,r=this;void 0===e&&(e=null),t=(e=e||{}).customHashFragment?this.urlHelper.getHashFragmentParams(e.customHashFragment):this.urlHelper.getHashFragmentParams(),this.debug("parsed url",t);var o=t.state,n=__read(this.parseState(o),2),s=n[0],i=n[1];if(this.state=i,t.error){this.debug("error trying to login"),this.handleLoginError(e,t);var a=new OAuthErrorEvent("token_error",{},t);return this.eventsSubject.next(a),Promise.reject(a)}var c=t.access_token,u=t.id_token,h=t.session_state,l=t.scope;if(!this.requestAccessToken&&!this.oidc)return Promise.reject("Either requestAccessToken or oidc (or both) must be true.");if(this.requestAccessToken&&!c)return Promise.resolve(!1);if(this.requestAccessToken&&!e.disableOAuth2StateCheck&&!o)return Promise.resolve(!1);if(this.oidc&&!u)return Promise.resolve(!1);if((this.sessionChecksEnabled&&!h&&this.logger.warn("session checks (Session Status Change Notification) were activated in the configuration but the id_token does not contain a session_state claim"),this.requestAccessToken&&!e.disableOAuth2StateCheck)&&!this.validateNonce(s)){var d=new OAuthErrorEvent("invalid_nonce_in_state",null);return this.eventsSubject.next(d),Promise.reject(d)}return this.requestAccessToken&&this.storeAccessTokenResponse(c,null,t.expires_in||this.fallbackAccessTokenExpirationTimeInSec,l),this.oidc?this.processIdToken(u,c).then((function(t){return e.validationHandler?e.validationHandler({accessToken:c,idClaims:t.idTokenClaims,idToken:t.idToken,state:o}).then((function(e){return t})):t})).then((function(t){return r.storeIdToken(t),r.storeSessionState(h),r.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&(location.hash=""),r.eventsSubject.next(new OAuthSuccessEvent("token_received")),r.callOnTokenReceivedIfExists(e),r.inImplicitFlow=!1,!0})).catch((function(e){return r.eventsSubject.next(new OAuthErrorEvent("token_validation_error",e)),r.logger.error("Error validating tokens"),r.logger.error(e),Promise.reject(e)})):(this.eventsSubject.next(new OAuthSuccessEvent("token_received")),this.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&(location.hash=""),this.callOnTokenReceivedIfExists(e),Promise.resolve(!0))},t.prototype.parseState=function(e){var t=e,r="";if(e){var o=e.indexOf(this.config.nonceStateSeparator);o>-1&&(t=e.substr(0,o),r=e.substr(o+this.config.nonceStateSeparator.length))}return[t,r]},t.prototype.validateNonce=function(e){var t;if((t=this.saveNoncesInLocalStorage&&void 0!==window.localStorage?localStorage.getItem("nonce"):this._storage.getItem("nonce"))!==e){return console.error("Validating access_token failed, wrong state/nonce.",t,e),!1}return!0},t.prototype.storeIdToken=function(e){this._storage.setItem("id_token",e.idToken),this._storage.setItem("id_token_claims_obj",e.idTokenClaimsJson),this._storage.setItem("id_token_expires_at",""+e.idTokenExpiresAt),this._storage.setItem("id_token_stored_at",""+Date.now())},t.prototype.storeSessionState=function(e){this._storage.setItem("session_state",e)},t.prototype.getSessionState=function(){return this._storage.getItem("session_state")},t.prototype.handleLoginError=function(e,t){e.onLoginError&&e.onLoginError(t),this.clearHashAfterLogin&&!e.preventClearHashAfterLogin&&(location.hash="")},t.prototype.processIdToken=function(e,t,r){var o=this;void 0===r&&(r=!1);var n,s=e.split("."),i=b64DecodeUnicode(this.padBase64(s[0])),a=JSON.parse(i),c=b64DecodeUnicode(this.padBase64(s[1])),u=JSON.parse(c);if(n=this.saveNoncesInLocalStorage&&void 0!==window.localStorage?localStorage.getItem("nonce"):this._storage.getItem("nonce"),Array.isArray(u.aud)){if(u.aud.every((function(e){return e!==o.clientId}))){var h="Wrong audience: "+u.aud.join(",");return this.logger.warn(h),Promise.reject(h)}}else if(u.aud!==this.clientId){h="Wrong audience: "+u.aud;return this.logger.warn(h),Promise.reject(h)}if(!u.sub){h="No sub claim in id_token";return this.logger.warn(h),Promise.reject(h)}if(this.sessionChecksEnabled&&this.silentRefreshSubject&&this.silentRefreshSubject!==u.sub){h="After refreshing, we got an id_token for another user (sub). Expected sub: "+this.silentRefreshSubject+", received sub: "+u.sub;return this.logger.warn(h),Promise.reject(h)}if(!u.iat){h="No iat claim in id_token";return this.logger.warn(h),Promise.reject(h)}if(!this.skipIssuerCheck&&u.iss!==this.issuer){h="Wrong issuer: "+u.iss;return this.logger.warn(h),Promise.reject(h)}if(!r&&u.nonce!==n){h="Wrong nonce: "+u.nonce;return this.logger.warn(h),Promise.reject(h)}if(!this.hasOwnProperty("responseType")||"code"!==this.responseType&&"id_token"!==this.responseType||(this.disableAtHashCheck=!0),!this.disableAtHashCheck&&this.requestAccessToken&&!u.at_hash){h="An at_hash is needed!";return this.logger.warn(h),Promise.reject(h)}var l=Date.now(),d=1e3*u.iat,p=1e3*u.exp,f=1e3*(this.clockSkewInSec||600);if(d-f>=l||p+f<=l){h="Token has expired";return console.error(h),console.error({now:l,issuedAtMSec:d,expiresAtMSec:p}),Promise.reject(h)}var v={accessToken:t,idToken:e,jwks:this.jwks,idTokenClaims:u,idTokenHeader:a,loadKeys:function(){return o.loadJwks()}};return this.disableAtHashCheck?this.checkSignature(v).then((function(t){return{idToken:e,idTokenClaims:u,idTokenClaimsJson:c,idTokenHeader:a,idTokenHeaderJson:i,idTokenExpiresAt:p}})):this.checkAtHash(v).then((function(t){if(!o.disableAtHashCheck&&o.requestAccessToken&&!t){var r="Wrong at_hash";return o.logger.warn(r),Promise.reject(r)}return o.checkSignature(v).then((function(t){var r=!o.disableAtHashCheck,n={idToken:e,idTokenClaims:u,idTokenClaimsJson:c,idTokenHeader:a,idTokenHeaderJson:i,idTokenExpiresAt:p};return r?o.checkAtHash(v).then((function(e){if(o.requestAccessToken&&!e){var t="Wrong at_hash";return o.logger.warn(t),Promise.reject(t)}return n})):n}))}))},t.prototype.getIdentityClaims=function(){var e=this._storage.getItem("id_token_claims_obj");return e?JSON.parse(e):null},t.prototype.getGrantedScopes=function(){var e=this._storage.getItem("granted_scopes");return e?JSON.parse(e):null},t.prototype.getIdToken=function(){return this._storage?this._storage.getItem("id_token"):null},t.prototype.padBase64=function(e){for(;e.length%4!=0;)e+="=";return e},t.prototype.getAccessToken=function(){return this._storage?this._storage.getItem("access_token"):null},t.prototype.getRefreshToken=function(){return this._storage?this._storage.getItem("refresh_token"):null},t.prototype.getAccessTokenExpiration=function(){return this._storage.getItem("expires_at")?parseInt(this._storage.getItem("expires_at"),10):null},t.prototype.getAccessTokenStoredAt=function(){return parseInt(this._storage.getItem("access_token_stored_at"),10)},t.prototype.getIdTokenStoredAt=function(){return parseInt(this._storage.getItem("id_token_stored_at"),10)},t.prototype.getIdTokenExpiration=function(){return this._storage.getItem("id_token_expires_at")?parseInt(this._storage.getItem("id_token_expires_at"),10):null},t.prototype.hasValidAccessToken=function(){if(this.getAccessToken()){var e=this._storage.getItem("expires_at"),t=new Date;return!(e&&parseInt(e,10)<t.getTime())}return!1},t.prototype.hasValidIdToken=function(){if(this.getIdToken()){var e=this._storage.getItem("id_token_expires_at"),t=new Date;return!(e&&parseInt(e,10)<t.getTime())}return!1},t.prototype.getCustomTokenResponseProperty=function(e){return this._storage&&this.config.customTokenParameters&&this.config.customTokenParameters.indexOf(e)>=0&&null!==this._storage.getItem(e)?JSON.parse(this._storage.getItem(e)):null},t.prototype.authorizationHeader=function(){return"Bearer "+this.getAccessToken()},t.prototype.logOut=function(e,t){var r=this;void 0===e&&(e={}),void 0===t&&(t="");var o=!1;"boolean"==typeof e&&(o=e,e={});var n=this.getIdToken();if(this._storage.removeItem("access_token"),this._storage.removeItem("id_token"),this._storage.removeItem("refresh_token"),this.saveNoncesInLocalStorage?(localStorage.removeItem("nonce"),localStorage.removeItem("PKCE_verifier")):(this._storage.removeItem("nonce"),this._storage.removeItem("PKCE_verifier")),this._storage.removeItem("expires_at"),this._storage.removeItem("id_token_claims_obj"),this._storage.removeItem("id_token_expires_at"),this._storage.removeItem("id_token_stored_at"),this._storage.removeItem("access_token_stored_at"),this._storage.removeItem("granted_scopes"),this._storage.removeItem("session_state"),this.config.customTokenParameters&&this.config.customTokenParameters.forEach((function(e){return r._storage.removeItem(e)})),this.silentRefreshSubject=null,this.eventsSubject.next(new OAuthInfoEvent("logout")),this.logoutUrl&&!o&&(n||this.postLogoutRedirectUri)){var s;if(!this.validateUrlForHttps(this.logoutUrl))throw new Error("logoutUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");if(this.logoutUrl.indexOf("{{")>-1)s=this.logoutUrl.replace(/\{\{id_token\}\}/,n).replace(/\{\{client_id\}\}/,this.clientId);else{var i=new http.HttpParams;n&&(i=i.set("id_token_hint",n));var a=this.postLogoutRedirectUri||this.redirectUri;for(var c in a&&(i=i.set("post_logout_redirect_uri",a),t&&(i=i.set("state",t))),e)i=i.set(c,e[c]);s=this.logoutUrl+(this.logoutUrl.indexOf("?")>-1?"&":"?")+i.toString()}this.config.openUri(s)}},t.prototype.createAndSaveNonce=function(){var e=this;return this.createNonce().then((function(t){return e.saveNoncesInLocalStorage&&void 0!==window.localStorage?localStorage.setItem("nonce",t):e._storage.setItem("nonce",t),t}))},t.prototype.ngOnDestroy=function(){this.clearAccessTokenTimer(),this.clearIdTokenTimer(),this.removeSilentRefreshEventListener();var e=this.document.getElementById(this.silentRefreshIFrameName);e&&e.remove(),this.stopSessionCheckTimer(),this.removeSessionCheckEventListener();var t=this.document.getElementById(this.sessionCheckIFrameName);t&&t.remove()},t.prototype.createNonce=function(){var e=this;return new Promise((function(t){if(e.rngUrl)throw new Error("createNonce with rng-web-api has not been implemented so far");var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",o=45,n="",s="undefined"==typeof self?null:self.crypto||self.msCrypto;if(s){var i=new Uint8Array(o);s.getRandomValues(i),i.map||(i.map=Array.prototype.map),i=i.map((function(e){return r.charCodeAt(e%r.length)})),n=String.fromCharCode.apply(null,i)}else for(;0<o--;)n+=r[Math.random()*r.length|0];t(base64UrlEncode(n))}))},t.prototype.checkAtHash=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return this.tokenValidationHandler?[2,this.tokenValidationHandler.validateAtHash(e)]:(this.logger.warn("No tokenValidationHandler configured. Cannot check at_hash."),[2,!0])}))}))},t.prototype.checkSignature=function(e){return this.tokenValidationHandler?this.tokenValidationHandler.validateSignature(e):(this.logger.warn("No tokenValidationHandler configured. Cannot check signature."),Promise.resolve(null))},t.prototype.initLoginFlow=function(e,t){return void 0===e&&(e=""),void 0===t&&(t={}),"code"===this.responseType?this.initCodeFlow(e,t):this.initImplicitFlow(e,t)},t.prototype.initCodeFlow=function(e,t){var r=this;void 0===e&&(e=""),void 0===t&&(t={}),""!==this.loginUrl?this.initCodeFlowInternal(e,t):this.events.pipe(operators.filter((function(e){return"discovery_document_loaded"===e.type}))).subscribe((function(o){return r.initCodeFlowInternal(e,t)}))},t.prototype.initCodeFlowInternal=function(e,t){if(void 0===e&&(e=""),void 0===t&&(t={}),!this.validateUrlForHttps(this.loginUrl))throw new Error("loginUrl  must use HTTPS (with TLS), or config value for property 'requireHttps' must be set to 'false' and allow HTTP (without TLS).");this.createLoginUrl(e,"",null,!1,t).then(this.config.openUri).catch((function(e){console.error("Error in initAuthorizationCodeFlow"),console.error(e)}))},t.prototype.createChallangeVerifierPairForPKCE=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:if(!this.crypto)throw new Error("PKCE support for code flow needs a CryptoHander. Did you import the OAuthModule using forRoot() ?");return[4,this.createNonce()];case 1:return e=r.sent(),[4,this.crypto.calcHash(e,"sha-256")];case 2:return t=r.sent(),[2,[base64UrlEncode(t),e]]}}))}))},t.prototype.extractRecognizedCustomParameters=function(e){var t=new Map;return this.config.customTokenParameters?(this.config.customTokenParameters.forEach((function(r){e[r]&&t.set(r,JSON.stringify(e[r]))})),t):t},t.prototype.revokeTokenAndLogout=function(e,t){var r,o,n=this;void 0===e&&(e={}),void 0===t&&(t=!1);var s=this.revocationEndpoint,i=this.getAccessToken(),a=this.getRefreshToken();if(i){var c=new http.HttpParams,u=(new http.HttpHeaders).set("Content-Type","application/x-www-form-urlencoded");if(this.useHttpBasicAuth){var h=btoa(this.clientId+":"+this.dummyClientSecret);u=u.set("Authorization","Basic "+h)}if(this.useHttpBasicAuth||(c=c.set("client_id",this.clientId)),!this.useHttpBasicAuth&&this.dummyClientSecret&&(c=c.set("client_secret",this.dummyClientSecret)),this.customQueryParams)try{for(var l=__values(Object.getOwnPropertyNames(this.customQueryParams)),d=l.next();!d.done;d=l.next()){var p=d.value;c=c.set(p,this.customQueryParams[p])}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return new Promise((function(r,o){var h,l;if(i){var d=c.set("token",i).set("token_type_hint","access_token");h=n.http.post(s,d,{headers:u})}else h=rxjs.of(null);if(a){d=c.set("token",a).set("token_type_hint","refresh_token");l=n.http.post(s,d,{headers:u})}else l=rxjs.of(null);t&&(h=h.pipe(operators.catchError((function(e){return 0===e.status?rxjs.of(null):rxjs.throwError(e)}))),l=l.pipe(operators.catchError((function(e){return 0===e.status?rxjs.of(null):rxjs.throwError(e)})))),rxjs.combineLatest([h,l]).subscribe((function(t){n.logOut(e),r(t),n.logger.info("Token successfully revoked")}),(function(e){n.logger.error("Error revoking token",e),n.eventsSubject.next(new OAuthErrorEvent("token_revoke_error",e)),o(e)}))}))}},t}(AuthConfig);OAuthService.decorators=[{type:core.Injectable}],OAuthService.ctorParameters=function(){return[{type:core.NgZone},{type:http.HttpClient},{type:OAuthStorage,decorators:[{type:core.Optional}]},{type:ValidationHandler,decorators:[{type:core.Optional}]},{type:AuthConfig,decorators:[{type:core.Optional}]},{type:UrlHelperService},{type:OAuthLogger},{type:HashHandler,decorators:[{type:core.Optional}]},{type:void 0,decorators:[{type:core.Inject,args:[common.DOCUMENT]}]}]};var OAuthModuleConfig=function(){},OAuthResourceServerConfig=function(){},OAuthResourceServerErrorHandler=function(){},OAuthNoopResourceServerErrorHandler=function(){function e(){}return e.prototype.handleError=function(e){return rxjs.throwError(e)},e}(),DefaultOAuthInterceptor=function(){function e(e,t,r,o){this.authStorage=e,this.oAuthService=t,this.errorHandler=r,this.moduleConfig=o}return e.prototype.checkUrl=function(e){return this.moduleConfig.resourceServer.customUrlValidation?this.moduleConfig.resourceServer.customUrlValidation(e):!this.moduleConfig.resourceServer.allowedUrls||!!this.moduleConfig.resourceServer.allowedUrls.find((function(t){return e.startsWith(t)}))},e.prototype.intercept=function(e,t){var r=this,o=e.url.toLowerCase();return this.moduleConfig&&this.moduleConfig.resourceServer&&this.checkUrl(o)?this.moduleConfig.resourceServer.sendAccessToken?rxjs.merge(rxjs.of(this.oAuthService.getAccessToken()).pipe(operators.filter((function(e){return!!e}))),this.oAuthService.events.pipe(operators.filter((function(e){return"token_received"===e.type})),operators.timeout(this.oAuthService.waitForTokenInMsec||0),operators.catchError((function(e){return rxjs.of(null)})),operators.map((function(e){return r.oAuthService.getAccessToken()})))).pipe(operators.take(1),operators.mergeMap((function(o){if(o){var n="Bearer "+o,s=e.headers.set("Authorization",n);e=e.clone({headers:s})}return t.handle(e).pipe(operators.catchError((function(e){return r.errorHandler.handleError(e)})))}))):t.handle(e).pipe(operators.catchError((function(e){return r.errorHandler.handleError(e)}))):t.handle(e)},e}();DefaultOAuthInterceptor.decorators=[{type:core.Injectable}],DefaultOAuthInterceptor.ctorParameters=function(){return[{type:OAuthStorage},{type:OAuthService},{type:OAuthResourceServerErrorHandler},{type:OAuthModuleConfig,decorators:[{type:core.Optional}]}]};var NullValidationHandler=function(){function e(){}return e.prototype.validateSignature=function(e){return Promise.resolve(null)},e.prototype.validateAtHash=function(e){return Promise.resolve(!0)},e}();function createDefaultLogger(){return console}function createDefaultStorage(){return"undefined"!=typeof sessionStorage?sessionStorage:new MemoryStorage}var OAuthModule=function(){function e(){}return e.forRoot=function(t,r){return void 0===t&&(t=null),void 0===r&&(r=NullValidationHandler),{ngModule:e,providers:[OAuthService,UrlHelperService,{provide:OAuthLogger,useFactory:createDefaultLogger},{provide:OAuthStorage,useFactory:createDefaultStorage},{provide:ValidationHandler,useClass:r},{provide:HashHandler,useClass:DefaultHashHandler},{provide:OAuthResourceServerErrorHandler,useClass:OAuthNoopResourceServerErrorHandler},{provide:OAuthModuleConfig,useValue:t},{provide:http.HTTP_INTERCEPTORS,useClass:DefaultOAuthInterceptor,multi:!0}]}},e}();OAuthModule.decorators=[{type:core.NgModule,args:[{imports:[common.CommonModule],declarations:[],exports:[]}]}];var err="PLEASE READ THIS CAREFULLY:\n\nBeginning with angular-oauth2-oidc version 9, the JwksValidationHandler\nhas been moved to an library of its own. If you need it for implementing\nOAuth2/OIDC **implicit flow**, please install it using npm:\n\n  npm i angular-oauth2-oidc-jwks --save\n\nAfter that, you can import it into your application:\n\n  import { JwksValidationHandler } from 'angular-oauth2-oidc-jwks';\n\nPlease note, that this dependency is not needed for the **code flow**,\nwhich is nowadays the **recommented** one for single page applications.\nThis also results in smaller bundle sizes.\n",JwksValidationHandler=function(e){function t(){var t=e.call(this)||this;return console.error(err),t}return __extends(t,e),t}(NullValidationHandler),AUTH_CONFIG=new core.InjectionToken("AUTH_CONFIG");exports.AUTH_CONFIG=AUTH_CONFIG,exports.AbstractValidationHandler=AbstractValidationHandler,exports.AuthConfig=AuthConfig,exports.DefaultOAuthInterceptor=DefaultOAuthInterceptor,exports.JwksValidationHandler=JwksValidationHandler,exports.LoginOptions=LoginOptions,exports.MemoryStorage=MemoryStorage,exports.NullValidationHandler=NullValidationHandler,exports.OAuthErrorEvent=OAuthErrorEvent,exports.OAuthEvent=OAuthEvent,exports.OAuthInfoEvent=OAuthInfoEvent,exports.OAuthLogger=OAuthLogger,exports.OAuthModule=OAuthModule,exports.OAuthModuleConfig=OAuthModuleConfig,exports.OAuthNoopResourceServerErrorHandler=OAuthNoopResourceServerErrorHandler,exports.OAuthResourceServerConfig=OAuthResourceServerConfig,exports.OAuthResourceServerErrorHandler=OAuthResourceServerErrorHandler,exports.OAuthService=OAuthService,exports.OAuthStorage=OAuthStorage,exports.OAuthSuccessEvent=OAuthSuccessEvent,exports.ReceivedTokens=ReceivedTokens,exports.UrlHelperService=UrlHelperService,exports.ValidationHandler=ValidationHandler,exports.ɵa=HashHandler,exports.ɵb=DefaultHashHandler,exports.ɵc=createDefaultLogger,exports.ɵd=createDefaultStorage,Object.defineProperty(exports,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-oauth2-oidc.umd.min.js.map